# âœ… ç”¨æˆ·åˆ†äº«åŠŸèƒ½ - å®é™…åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ å®Œæˆå†…å®¹æ€»ç»“

### 1. å‰ç«¯å±•ç¤º âœ…
- **é¡µé¢è·¯å¾„**: `/sharing`
- **å±•ç¤ºå½¢å¼**: 3åˆ—ç½‘æ ¼åª’ä½“å—å¸ƒå±€
- **åª’ä½“å—å†…å®¹**:
  - æ ‡é¢˜ï¼ˆ2è¡Œæˆªæ–­ï¼‰
  - å†…å®¹é¢„è§ˆï¼ˆ3è¡Œæˆªæ–­ï¼‰
  - ç‚¹èµæ•°å’Œæµè§ˆæ•°ç»Ÿè®¡
  - "Chi tiáº¿t" é“¾æ¥
- **äº¤äº’åŠŸèƒ½**: 
  - æ‚¬åœæ”¾å¤§æ•ˆæœ
  - ç‚¹å‡»è·³è½¬è¯¦æƒ…é¡µ
  - åˆ†ç±»ç­›é€‰æŒ‰é’®
  - åˆ†é¡µå¯¼èˆª
- **æ¸²æŸ“æ–¹å¼**: SSR æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œå®æ—¶ä»æ•°æ®åº“è¯»å–

### 2. åç«¯API âœ…

**æ•°æ®åº“æ¨¡å‹ `UserShare`**ï¼š
- **å¿…å¡«å­—æ®µï¼ˆæ•°æ®åº“å±‚ï¼‰**: `title`, `content`, `author_name`
- **N8Næ¥å£åªéœ€**: `title`, `content`ï¼ˆauthor_nameè‡ªåŠ¨å¡«å……ä¸º"NgÆ°á»i dÃ¹ng áº©n danh"ï¼‰
- **å¯é€‰å­—æ®µ**: `surgery_type`, `hospital_name`, `rating`, `images`, `tags`, `author_avatar`
- **è‡ªåŠ¨å­—æ®µ**: `like_count`(0), `view_count`(0), `status`(published), `source`(manual)

**API æ¥å£åˆ—è¡¨**ï¼š
- `GET /api/user-shares` - è·å–åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æœç´¢ï¼‰
- `GET /api/user-shares/:id` - è·å–è¯¦æƒ…ï¼ˆè‡ªåŠ¨+1æµè§ˆæ•°ï¼‰
- `POST /api/user-shares` - åˆ›å»ºåˆ†äº«ï¼ˆå®Œæ•´å­—æ®µï¼‰
- `PUT /api/user-shares/:id` - æ›´æ–°åˆ†äº«
- `DELETE /api/user-shares/:id` - åˆ é™¤åˆ†äº«
- `POST /api/user-shares/:id/like` - ç‚¹èµï¼ˆè‡ªåŠ¨+1ç‚¹èµæ•°ï¼‰
- `POST /api/user-shares/n8n` - N8Nä¸“ç”¨æ¥å£ï¼ˆæœ€ç®€ï¼‰
- `POST /api/webhooks/n8n` - é€šç”¨Webhookï¼ˆéœ€typeå­—æ®µï¼‰
- `POST /api/webhooks/batch` - æ‰¹é‡å¤„ç†

### 3. N8N é›†æˆæ–¹å¼ï¼ˆä¸¤ç§ï¼‰âœ…

**æ–¹å¼1ï¼šç”¨æˆ·åˆ†äº«ä¸“ç”¨æ¥å£ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰**
- URL: `http://47.237.79.9:5002/api/user-shares/n8n`
- **æœ€ç®€æ•°æ®æ ¼å¼**ï¼ˆåªéœ€2ä¸ªå­—æ®µï¼‰ï¼š
```json
{
  "title": "æ ‡é¢˜",
  "content": "å†…å®¹"
}
```
- **è‡ªåŠ¨å¡«å……**ï¼š
  - `author_name` â†’ "NgÆ°á»i dÃ¹ng áº©n danh"ï¼ˆåŒ¿åç”¨æˆ·ï¼‰
  - `surgery_type` â†’ æ™ºèƒ½è¯†åˆ«ï¼ˆæ ¹æ®æ ‡é¢˜/å†…å®¹å…³é”®è¯ï¼‰
  - `rating` â†’ 5æ˜Ÿ
  - `author_age` â†’ 25
  - `status` â†’ "published"
  
**æ³¨æ„**ï¼šå‰ç«¯ä¸æ˜¾ç¤ºç”¨æˆ·åï¼Œç”¨æˆ·åä»…ç”¨äºæ•°æ®åº“è®°å½•

**æ–¹å¼2ï¼šé€šç”¨Webhookæ¥å£**
- URL: `http://47.237.79.9:5002/api/webhooks/n8n`
- **æ•°æ®æ ¼å¼**ï¼ˆéœ€è¦typeå­—æ®µï¼Œä¸”éœ€æä¾›author_nameï¼‰ï¼š
```json
{
  "type": "user_share",
  "data": {
    "title": "æ ‡é¢˜",
    "content": "å†…å®¹",
    "author_name": "ä½œè€…å"
  }
}
```

**æ–¹å¼3ï¼šæ ‡å‡†APIæ¥å£**
- URL: `http://47.237.79.9:5002/api/user-shares`
- **æ•°æ®æ ¼å¼**ï¼ˆå¿…é¡»æä¾›title, content, author_nameï¼‰ï¼š
```json
{
  "title": "æ ‡é¢˜",
  "content": "å†…å®¹",
  "author_name": "ä½œè€…å",
  "surgery_type": "Pháº«u thuáº­t mÅ©i",
  "hospital_name": "BV tháº©m má»¹",
  "rating": 5
}
```

**æ™ºèƒ½åˆ†ç±»åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ ¹æ®æ ‡é¢˜å’Œå†…å®¹è¯†åˆ«æ‰‹æœ¯ç±»å‹
- æ”¯æŒï¼šé¼»éƒ¨ã€çœ¼éƒ¨ã€é¢éƒ¨è½®å»“ã€èº«ä½“å¡‘å½¢ã€çš®è‚¤ç¾å®¹
- æ‰¾ä¸åˆ°å…³é”®è¯æ—¶å½’ç±»ä¸º"Chia sáº» chung"

**é˜²é‡å¤**: é€šè¿‡ `external_id` å­—æ®µï¼ˆåŒIDä¼šæ›´æ–°è€Œéæ–°å»ºï¼‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: é€šè¿‡ N8N Webhook

åœ¨ N8N å·¥ä½œæµä¸­æ·»åŠ  HTTP Request èŠ‚ç‚¹ï¼š
- **Method**: POST
- **URL**: `http://47.237.79.9:5002/api/webhooks/n8n`
- **Body**:
```json
{
  "type": "user_share",
  "data": {
    "title": "{{ $json.title }}",
    "content": "{{ $json.content }}",
    "author_name": "{{ $json.author_name }}"
  }
}
```

### æ–¹æ³•2: ç›´æ¥ API è°ƒç”¨

```bash
curl -X POST http://47.237.79.9:5002/api/webhooks/n8n \
  -H "Content-Type: application/json" \
  -d '{
    "type": "user_share",
    "data": {
      "title": "Tráº£i nghiá»‡m NÃ¢ng mÅ©i Sá»¥n sÆ°á»n táº¡i Há»“ ChÃ­ Minh",
      "content": "Kinh nghiá»‡m há»“i phá»¥c, Äƒn gÃ¬ Ä‘á»ƒ mau lÃ nh vÃ  nhá»¯ng Ä‘iá»u cáº§n trÃ¡nh...",
      "author_name": "Chá»‹ Nguyá»…n"
    }
  }'
```

### æ–¹æ³•3: å®Œæ•´å­—æ®µæäº¤

```bash
curl -X POST http://47.237.79.9:5002/api/webhooks/n8n \
  -H "Content-Type: application/json" \
  -d '{
    "type": "user_share",
    "data": {
      "title": "Tráº£i nghiá»‡m NÃ¢ng mÅ©i táº¡i ÄÃ  Náºµng",
      "content": "Chia sáº» chi tiáº¿t vá» quÃ¡ trÃ¬nh pháº«u thuáº­t vÃ  phá»¥c há»“i...",
      "author_name": "Anh Tráº§n",
      "surgery_type": "Pháº«u thuáº­t mÅ©i",
      "hospital_name": "Bá»‡nh viá»‡n tháº©m má»¹ ÄÃ  Náºµng",
      "rating": 5,
      "images": ["url1.jpg", "url2.jpg"],
      "tags": ["nÃ¢ng mÅ©i", "sá»¥n sÆ°á»n"]
    },
    "source": "n8n"
  }'
```

### æ–¹æ³•4: æ‰¹é‡å¯¼å…¥

```bash
curl -X POST http://47.237.79.9:5002/api/webhooks/batch \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {
        "type": "user_share",
        "data": {
          "title": "åˆ†äº«1",
          "content": "å†…å®¹1",
          "author_name": "ç”¨æˆ·1"
        }
      },
      {
        "type": "user_share",
        "data": {
          "title": "åˆ†äº«2",
          "content": "å†…å®¹2",
          "author_name": "ç”¨æˆ·2"
        }
      }
    ]
  }'
```

## ğŸ§ª æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•
```bash
# æäº¤åˆ†äº«
curl --noproxy "*" -X POST http://localhost:5002/api/webhooks/n8n \
  -H "Content-Type: application/json" \
  -d '{
    "type": "user_share",
    "data": {
      "title": "æµ‹è¯•åˆ†äº«",
      "content": "æµ‹è¯•å†…å®¹",
      "author_name": "æµ‹è¯•ç”¨æˆ·"
    }
  }'

# æŸ¥çœ‹åˆ—è¡¨
curl --noproxy "*" http://localhost:5002/api/user-shares
```

## ğŸ“Š æ•°æ®æµç¨‹

```
N8N å‘é€æ•°æ®
    â†“
POST /api/webhooks/n8n
    â†“
åç«¯éªŒè¯æ•°æ®
    â†“
ä¿å­˜åˆ° SQLite æ•°æ®åº“
    â†“
å‰ç«¯ SSR è¯»å–æ•°æ®
    â†“
ç”¨æˆ·è®¿é—®é¡µé¢çœ‹åˆ°æ–°åˆ†äº«
```

## ğŸ” è®¿é—®åœ°å€

- **å‰ç«¯åˆ—è¡¨é¡µ**: http://47.237.79.9:5001/sharing
- **å‰ç«¯è¯¦æƒ…é¡µ**: http://47.237.79.9:5001/sharing/{id}
- **åç«¯ API**: http://47.237.79.9:5002/api/user-shares
- **å¥åº·æ£€æŸ¥**: http://47.237.79.9:5002/health

## ğŸ“ ç›¸å…³æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/src/pages/sharing.astro` - åˆ—è¡¨é¡µ
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/src/pages/sharing/[id].astro` - è¯¦æƒ…é¡µ
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/src/utils/api.js` - API è°ƒç”¨å·¥å…·

### åç«¯æ–‡ä»¶
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/src/models/UserShare.js` - æ•°æ®æ¨¡å‹
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/src/api/userShareRoutes.js` - API è·¯ç”±
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/src/api/webhookRoutes.js` - Webhook å¤„ç†
- `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/data/database.sqlite` - æ•°æ®åº“æ–‡ä»¶

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. ç®€åŒ–æ•°æ®æäº¤
åªéœ€è¦æä¾› `title`, `content`, `author_name` ä¸‰ä¸ªå¿…å¡«å­—æ®µï¼Œå…¶ä»–å­—æ®µå¯é€‰ã€‚

### 2. å®æ—¶æ›´æ–°
ä½¿ç”¨ SSR æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œæ¯æ¬¡é¡µé¢åŠ è½½éƒ½ä¼šä»æ•°æ®åº“è¯»å–æœ€æ–°æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°æˆ–æ„å»ºã€‚

### 3. é˜²é‡å¤
é€šè¿‡ `external_id` å­—æ®µé˜²æ­¢é‡å¤æäº¤ï¼Œç›¸åŒ ID çš„æ•°æ®ä¼šæ›´æ–°è€Œä¸æ˜¯æ–°å»ºã€‚

### 4. å®Œæ•´åˆ†é¡µ
æ”¯æŒåˆ†é¡µå¯¼èˆªï¼Œæ¯é¡µæ˜¾ç¤º 36 ä¸ªåˆ†äº«ï¼Œè‡ªåŠ¨è®¡ç®—æ€»é¡µæ•°ã€‚

### 5. åª’ä½“å—å±•ç¤º
ç®€æ´çš„å¡ç‰‡å¼è®¾è®¡ï¼ŒåŒ…å«æ ‡é¢˜ã€å†…å®¹é¢„è§ˆå’Œç»Ÿè®¡ä¿¡æ¯ã€‚

## ğŸ“ å­—æ®µè¯´æ˜

### å¿…å¡«å­—æ®µ
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `title` | String | åˆ†äº«æ ‡é¢˜ï¼ˆæœ€å¤š200å­—ç¬¦ï¼‰ |
| `content` | String | åˆ†äº«å†…å®¹ï¼ˆæ— é™åˆ¶ï¼‰ |
| `author_name` | String | ä½œè€…å§“åï¼ˆæœ€å¤š100å­—ç¬¦ï¼‰ |

### å¯é€‰å­—æ®µ
| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `author_avatar` | String | null | ä½œè€…å¤´åƒURL |
| `surgery_type` | String | null | æ‰‹æœ¯ç±»å‹ |
| `hospital_name` | String | null | åŒ»é™¢åç§° |
| `rating` | Integer | null | è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰ |
| `images` | Array | [] | å›¾ç‰‡URLæ•°ç»„ |
| `tags` | Array | [] | æ ‡ç­¾æ•°ç»„ |
| `status` | String | "published" | çŠ¶æ€ |
| `source` | String | "n8n" | æ•°æ®æ¥æº |
| `external_id` | String | è‡ªåŠ¨ç”Ÿæˆ | å¤–éƒ¨ç³»ç»ŸID |

### è‡ªåŠ¨å­—æ®µ
| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `like_count` | Integer | 0 | ç‚¹èµæ¬¡æ•° |
| `view_count` | Integer | 0 | æµè§ˆæ¬¡æ•° |
| `createdAt` | DateTime | å½“å‰æ—¶é—´ | åˆ›å»ºæ—¶é—´ |
| `updatedAt` | DateTime | å½“å‰æ—¶é—´ | æ›´æ–°æ—¶é—´ |

## ğŸ”’ é»˜è®¤å€¼

| å­—æ®µ | é»˜è®¤å€¼ |
|------|--------|
| status | "published" |
| source | "n8n" |
| like_count | 0 |
| view_count | 0 |
| images | [] |
| tags | [] |

## âœ¨ å·²æµ‹è¯•åŠŸèƒ½

- âœ… æœ€ç®€æ•°æ®æäº¤ï¼ˆtitle, content, author_nameï¼‰
- âœ… å®Œæ•´å­—æ®µæäº¤
- âœ… æ‰¹é‡æ•°æ®æäº¤
- âœ… æ•°æ®åº“å­˜å‚¨
- âœ… API æŸ¥è¯¢
- âœ… å‰ç«¯ SSR æ¸²æŸ“
- âœ… é˜²é‡å¤æœºåˆ¶
- âœ… åˆ†é¡µåŠŸèƒ½
- âœ… é»˜è®¤å€¼å¡«å……

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# åç«¯æœåŠ¡
systemctl status vietnam-medical-backend.service

# å‰ç«¯æœåŠ¡
systemctl status vietnam-medical.service
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
journalctl -u vietnam-medical-backend.service -f

# å‰ç«¯æ—¥å¿—
journalctl -u vietnam-medical.service -f
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯
systemctl restart vietnam-medical-backend.service

# é‡å¯å‰ç«¯
systemctl restart vietnam-medical.service
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ç®€å•åˆ†äº«
```json
{
  "type": "user_share",
  "data": {
    "title": "Pháº«u thuáº­t mÅ©i ráº¥t thÃ nh cÃ´ng",
    "content": "TÃ´i ráº¥t hÃ i lÃ²ng vá»›i káº¿t quáº£ pháº«u thuáº­t mÅ©i táº¡i bá»‡nh viá»‡n nÃ y.",
    "author_name": "Chá»‹ Mai"
  }
}
```

### ç¤ºä¾‹2: å®Œæ•´åˆ†äº«
```json
{
  "type": "user_share",
  "data": {
    "title": "Tráº£i nghiá»‡m NÃ¢ng mÅ©i S-line",
    "content": "Chia sáº» chi tiáº¿t vá» quÃ¡ trÃ¬nh tÆ° váº¥n, pháº«u thuáº­t vÃ  phá»¥c há»“i. BÃ¡c sÄ© ráº¥t táº­n tÃ¢m, káº¿t quáº£ Ä‘áº¹p tá»± nhiÃªn...",
    "author_name": "Anh Viá»‡t",
    "surgery_type": "Pháº«u thuáº­t mÅ©i",
    "hospital_name": "Bá»‡nh viá»‡n tháº©m má»¹ TP.HCM",
    "rating": 5,
    "tags": ["nÃ¢ng mÅ©i", "s-line", "sá»¥n tá»± thÃ¢n"],
    "external_id": "share_001"
  }
}
```

### ç¤ºä¾‹3: å¸¦å›¾ç‰‡åˆ†äº«
```json
{
  "type": "user_share",
  "data": {
    "title": "Káº¿t quáº£ sau 3 thÃ¡ng pháº«u thuáº­t máº¯t",
    "content": "So sÃ¡nh áº£nh trÆ°á»›c vÃ  sau pháº«u thuáº­t, máº¯t Ä‘Ã£ to vÃ  Ä‘áº¹p hÆ¡n ráº¥t nhiá»u.",
    "author_name": "Chá»‹ HÆ°Æ¡ng",
    "author_avatar": "https://example.com/avatar.jpg",
    "surgery_type": "Pháº«u thuáº­t máº¯t",
    "images": [
      "https://example.com/before.jpg",
      "https://example.com/after.jpg"
    ],
    "rating": 5
  }
}
```

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… å‰ç«¯é¡µé¢ä¼˜åŒ–å®Œæˆ
- âœ… åç«¯ API é…ç½®å®Œæˆ
- âœ… N8N Webhook é›†æˆå®Œæˆ
- âœ… æ•°æ®åº“æ¨¡å‹ä¼˜åŒ–å®Œæˆ
- âœ… SSR æ¸²æŸ“é…ç½®å®Œæˆ
- âœ… åˆ†é¡µåŠŸèƒ½å®ç°å®Œæˆ
- âœ… åª’ä½“å—ä¼˜åŒ–å®Œæˆ
- âœ… éƒ¨ç½²ä¸Šçº¿å®Œæˆ

---

**é…ç½®å®Œæˆæ—¶é—´**: 2024-10-08  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒå°±ç»ª

