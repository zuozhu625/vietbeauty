# è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›® - åç«¯å¼€å‘æ–‡æ¡£ v2.0

**ç‰ˆæœ¬**: v2.0 å®Œæ•´ç‰ˆ  
**æœ€åæ›´æ–°**: 2025-10-26  
**çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®åç«¯æœåŠ¡æ˜¯ä¸€ä¸ªåŸºäº Node.js + Express + SQLite çš„ RESTful API æœåŠ¡ï¼Œé‡‡ç”¨**åŒæ•°æ®åº“æ¶æ„**ï¼Œé›†æˆäº†**ä¸‰å¤§æ™ºèƒ½ä½“ç³»ç»Ÿ**ï¼ˆDQAã€ç¿»è¯‘æ™ºèƒ½ä½“ã€è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“ï¼‰ï¼Œæä¾›åŠ¨æ€å†…å®¹ç®¡ç†ã€æ•°æ®å­˜å‚¨å’Œå‰ç«¯æ•°æ®è°ƒç”¨åŠŸèƒ½ã€‚æ”¯æŒæ¥æ”¶å¤–éƒ¨ N8N å·¥ä½œæµæ•°æ®ï¼Œå®ç°å®Œæ•´çš„åŒ»ç¾çŸ¥è¯†åº“ç®¡ç†ã€‚

## ğŸ¯ é¡¹ç›®ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| **é¡¹ç›®åç§°** | è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®åç«¯æœåŠ¡ |
| **æŠ€æœ¯æ ˆ** | Node.js + Express + SQLite + Sequelize |
| **APIç‰ˆæœ¬** | v1.0.0 |
| **åç«¯æœåŠ¡ç«¯å£** | 5002 |
| **è®¿é—®åœ°å€** | http://47.237.79.9:5002 |
| **å‰ç«¯æœåŠ¡ç«¯å£** | 5001 |
| **æ•°æ®åº“** | ä¸¤ä¸ªç‹¬ç«‹SQLiteæ•°æ®åº“ |
| **æœåŠ¡ç®¡ç†** | systemd |

---

## ğŸ—ï¸ åŒæ•°æ®åº“æ¶æ„

### æ•°æ®åº“åˆ†ç¦»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›® - åŒæ•°æ®åº“æ¶æ„                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰ç«¯å±•ç¤ºå±‚ (Astro SSR)
    â”‚
    â”œâ”€â†’ è¯»å–: database.sqlite (è¶Šå—è¯­å‰ç«¯æ•°æ®)
    â”‚   â”œâ”€ user_shares (ç”¨æˆ·åˆ†äº«)
    â”‚   â”œâ”€ knowledge (çŸ¥è¯†é—®ç­” - è¶Šå—è¯­)
    â”‚   â”œâ”€ hospitals (åŒ»é™¢ä¿¡æ¯)
    â”‚   â””â”€ å…¶ä»–å‰ç«¯è¡¨
    â”‚
    â””â”€â†’ æ˜¾ç¤º: è¶Šå—è¯­å†…å®¹

AIæ™ºèƒ½ä½“ç³»ç»Ÿ
    â”‚
    â”œâ”€â†’ DQAç³»ç»Ÿ (JavaScript)
    â”‚   â””â”€ ç”Ÿæˆè¶Šå—è¯­é—®ç­” â†’ database.sqlite
    â”‚
    â”œâ”€â†’ ç¿»è¯‘æ™ºèƒ½ä½“ (Python)
    â”‚   â”œâ”€ è¯»å–: medical.db (ä¸­æ–‡é—®ç­”)
    â”‚   â”œâ”€ ç¿»è¯‘: ä¸­æ–‡ â†’ è¶Šå—è¯­
    â”‚   â””â”€ ä¿å­˜: database.sqlite (è¶Šå—è¯­)
    â”‚
    â””â”€â†’ è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“ (Python)
        â”œâ”€ æ£€æŸ¥: database.sqlite çš„è´¨é‡
        â”œâ”€ ä¿®æ­£: æ¸…ç†ä¸­æ–‡æ®‹ç•™
        â””â”€ è®°å½•: ä¿®æ”¹å†å²

è®­ç»ƒæ•°æ®åº“ (åŒ»ç”Ÿ/ç®¡ç†å‘˜ä¸“ç”¨)
    â”‚
    â””â”€â†’ medical.db (åŒ»é™¢ç³»ç»Ÿ)
        â”œâ”€ knowledge (1,829æ¡ä¸­æ–‡é—®ç­”)
        â”œâ”€ hospitals (åŒ»é™¢åŸºæœ¬ä¿¡æ¯)
        â””â”€ ç”¨äºAIè®­ç»ƒå’Œç¿»è¯‘
```

### æ•°æ®åº“é…ç½®

| æ•°æ®åº“ | æ–‡ä»¶è·¯å¾„ | ç”¨é€” | æ•°æ®è¯­è¨€ | è®¿é—®æ–¹å¼ |
|-------|--------|------|--------|---------|
| **frontend** | `/backend/data/database.sqlite` | å‰ç«¯å±•ç¤ºæ•°æ® | è¶Šå—è¯­ | å‰ç«¯SSRè¯»å– |
| **medical** | `/backend/data/medical.db` | AIè®­ç»ƒæ•°æ®åº“ | ä¸­æ–‡ | AIæ™ºèƒ½ä½“è¯»å– |

---

## ğŸ¤– ä¸‰å¤§æ™ºèƒ½ä½“ç³»ç»Ÿ

### ç³»ç»Ÿå¯¹æ¯”

| ç‰¹æ€§ | DQAç³»ç»Ÿ | ç¿»è¯‘æ™ºèƒ½ä½“ | è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“ |
|------|--------|----------|----------------|
| **ç‰ˆæœ¬** | v1.5.0 | v3.0 | v1.0 |
| **è„šæœ¬** | `backend/src/dqa/dqaGenerator.js` | `scripts/qa_translator_agent.py` | `scripts/qa_quality_checker.py` |
| **åŠŸèƒ½** | ç”ŸæˆåŒ»é™¢é—®ç­” | ç¿»è¯‘ä¸­æ–‡ä¸ºè¶Šå—è¯­ | æ£€æŸ¥å’Œä¿®æ­£è´¨é‡ |
| **æ•°æ®æº** | 122å®¶åŒ»é™¢ | medical.db (1,829æ¡) | database.sqlite |
| **è¾“å‡ºè¯­è¨€** | è¶Šå—è¯­ | è¶Šå—è¯­ (100%çº¯) | è¶Šå—è¯­ (ä¿®æ­£) |
| **è¿è¡Œé¢‘ç‡** | æ¯15åˆ†é’Ÿ1æ¡ | æ¯15åˆ†é’Ÿ1æ¡ | æ‰‹åŠ¨/å®šæœŸ |
| **æ—¥äº§é‡** | 96æ¡/å¤© | 96æ¡/å¤© | æŒ‰éœ€ |
| **ä½¿ç”¨æŠ€æœ¯** | æ¨¡æ¿+éšæœº | LLMç¿»è¯‘ | LLMæ£€æŸ¥ |

### DQAç³»ç»Ÿ (v1.5.0)

**ç‰¹ç‚¹**:
- âœ… åŸºäº122å®¶åŒ»é™¢æ•°æ®
- âœ… 6ç§é—®ç­”ç±»å‹ (èµ„è´¨ã€ç­‰çº§ã€æœåŠ¡ã€åœ°å€ã€è”ç³»ã€åŒ»ç”Ÿ)
- âœ… 15ç§å¼€åœºç™½ + 10ç§ç»“å°¾è¯­ + 14ç§è¿‡æ¸¡è¯
- âœ… åŒ»é™¢å’¨è¯¢ä¸“å±åˆ†ç±»
- âœ… 15åˆ†é’Ÿè‡ªåŠ¨ç”Ÿæˆ1æ¡

**æ–‡ä»¶**:
```
backend/src/dqa/
â”œâ”€â”€ dqaGenerator.js        # é—®ç­”ç”Ÿæˆå™¨
â”œâ”€â”€ dqaService.js          # æœåŠ¡ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ dqaScheduler.js        # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”œâ”€â”€ dqaRoutes.js           # APIè·¯ç”±
â”œâ”€â”€ hospitalDataExtractor.js # åŒ»é™¢æ•°æ®æå–
â”œâ”€â”€ chainHospitalEnhancer.js # è¿é”åŒ»é™¢å¢å¼º
â””â”€â”€ README.md              # æŠ€æœ¯æ–‡æ¡£
```

### ç¿»è¯‘æ™ºèƒ½ä½“ (v3.0)

**ç‰¹ç‚¹**:
- âœ… 1,829æ¡ä¸­æ–‡é—®ç­”ç¿»è¯‘
- âœ… 5å¤§åˆ†ç±»å‡åŒ€åˆ†å¸ƒ (ä¸°èƒ¸ã€äº”å®˜ã€äº§ä¿®ã€å¸è„‚ã€ç‰™çŸ«)
- âœ… 100%çº¯è¶Šå—è¯­ä¿è¯ (ä¸­æ–‡æ£€æµ‹+è‡ªåŠ¨æ¸…ç†)
- âœ… 5æ¬¡é‡è¯•æœºåˆ¶
- âœ… æ™ºèƒ½å¾ªç¯ï¼Œè¦†ç›–å…¨éƒ¨é—®ç­”

**æ–‡ä»¶**:
```
scripts/
â”œâ”€â”€ qa_translator_agent.py  # ä¸»ç¿»è¯‘æ™ºèƒ½ä½“
â”œâ”€â”€ qa_quality_checker.py   # è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“
â”œâ”€â”€ clean_chinese_records.py # æ¸…ç†ä¸­æ–‡æ®‹ç•™
â””â”€â”€ test_doubao_api.py      # APIæµ‹è¯•å·¥å…·
```

### è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“ (v1.0)

**ç‰¹ç‚¹**:
- âœ… 5ç»´åº¦è´¨é‡æ£€æŸ¥
  * å‡†ç¡®æ€§ (Accuracy)
  * ä¸€è‡´æ€§ (Consistency)
  * å®Œæ•´æ€§ (Completeness)
  * æ¸…æ™°åº¦ (Clarity)
  * å®‰å…¨æ€§ (Safety)
- âœ… è‡ªåŠ¨ä¿®æ­£é—®é¢˜
- âœ… è´¨é‡è¯„åˆ†ç³»ç»Ÿ
- âœ… ä¿®æ”¹å†å²è¿½è¸ª

---

## ğŸ”Œ å®Œæ•´APIç«¯ç‚¹æ–‡æ¡£

### å¥åº·æ£€æŸ¥

```http
GET /health
```

**å“åº”**:
```json
{
  "status": "ok",
  "timestamp": "2025-10-26T10:30:00.000Z",
  "uptime": 86400,
  "environment": "production"
}
```

### APIä¿¡æ¯

```http
GET /api/info
```

**å“åº”**:
```json
{
  "name": "Vietnam Medical Backend API",
  "version": "1.0.0",
  "description": "è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®åç«¯APIæœåŠ¡",
  "endpoints": {
    "userShares": "/api/user-shares",
    "knowledge": "/api/knowledge",
    "hospitals": "/api/hospitals",
    "services": "/api/services",
    "contacts": "/api/contacts",
    "webhooks": "/api/webhooks",
    "dqa": "/api/dqa"
  }
}
```

### ç”¨æˆ·åˆ†äº«API

#### è·å–ç”¨æˆ·åˆ†äº«åˆ—è¡¨
```http
GET /api/user-shares?page=1&limit=36&status=published&search=keyword
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤: 1)
- `limit`: æ¯é¡µæ•°é‡ (é»˜è®¤: 10)
- `status`: çŠ¶æ€ (published/draft/archived)
- `surgery_type`: æ‰‹æœ¯ç±»å‹
- `search`: æœç´¢å…³é”®è¯

#### è·å–å•ä¸ªç”¨æˆ·åˆ†äº«
```http
GET /api/user-shares/:id
```

**åŠŸèƒ½**: è·å–è¯¦æƒ…å¹¶è‡ªåŠ¨+1æµè§ˆæ•°

#### ç‚¹èµç”¨æˆ·åˆ†äº«
```http
POST /api/user-shares/:id/like
```

#### N8Nä¸“ç”¨æ¥å£
```http
POST /api/user-shares/n8n
Content-Type: application/json

{
  "title": "åˆ†äº«æ ‡é¢˜",
  "content": "åˆ†äº«å†…å®¹",
  "author_name": "ä½œè€…å",
  "surgery_type": "æ‰‹æœ¯ç±»å‹",
  "hospital_name": "åŒ»é™¢å",
  "rating": 5,
  "external_id": "n8n_123"
}
```

### çŸ¥è¯†é—®ç­”API

#### è·å–çŸ¥è¯†é—®ç­”åˆ—è¡¨
```http
GET /api/knowledge?page=1&limit=36&category=Tháº©m%20má»¹%20ngá»±c
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `category`: åˆ†ç±» (Tháº©m má»¹ ngá»±c, Tháº©m má»¹ khuÃ´n máº·t, Phá»¥c há»“i sau sinh, HÃºt má»¡ táº¡o dÃ¡ng, Niá»ng rÄƒng)
- `subcategory`: å­åˆ†ç±»
- `difficulty_level`: éš¾åº¦çº§åˆ«
- `search`: æœç´¢å…³é”®è¯

#### è·å–å•ä¸ªçŸ¥è¯†é—®ç­”
```http
GET /api/knowledge/:id
```

#### ç‚¹èµçŸ¥è¯†é—®ç­”
```http
POST /api/knowledge/:id/like
```

#### N8Nä¸“ç”¨æ¥å£
```http
POST /api/knowledge/n8n
Content-Type: application/json

{
  "question": "é—®é¢˜å†…å®¹",
  "answer": "ç­”æ¡ˆå†…å®¹",
  "category": "Tháº©m má»¹ ngá»±c",
  "doctor_name": "åŒ»ç”Ÿå",
  "external_id": "n8n_456"
}
```

### åŒ»é™¢API

#### è·å–åŒ»é™¢åˆ—è¡¨
```http
GET /api/hospitals?page=1&limit=36&city=Há»“%20ChÃ­%20Minh
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `city`: åŸå¸‚ (Há»“ ChÃ­ Minh, HÃ  Ná»™i, ÄÃ  Náºµng, Cáº§n ThÆ¡, BiÃªn HÃ²a)
- `type`: åŒ»é™¢ç±»å‹
- `level`: åŒ»é™¢ç­‰çº§ (A/B/C/D)
- `search`: æœç´¢å…³é”®è¯

#### è·å–å•ä¸ªåŒ»é™¢è¯¦æƒ…
```http
GET /api/hospitals/:id
```

**åŠŸèƒ½**: è·å–åŒ»é™¢ä¿¡æ¯å¹¶è‡ªåŠ¨+1æµè§ˆæ•°

### æœåŠ¡API

#### è·å–æœåŠ¡åˆ—è¡¨
```http
GET /api/services?category=Pháº«u%20thuáº­t%20mÅ©i
```

### è”ç³»API

#### åˆ›å»ºè”ç³»è®°å½•
```http
POST /api/contacts
Content-Type: application/json

{
  "name": "Nguyá»…n VÄƒn A",
  "email": "user@example.com",
  "phone": "+84-123-456-789",
  "subject": "TÆ° váº¥n pháº«u thuáº­t",
  "message": "æˆ‘æƒ³å’¨è¯¢...",
  "inquiry_type": "consultation",
  "preferred_contact": "email",
  "hospital_interest": "åŒ»é™¢å",
  "service_interest": "æœåŠ¡é¡¹ç›®",
  "budget_range": "2000-4000 USD",
  "timeline": "ThÃ¡ng 6/2024"
}
```

### DQAåŒ»é™¢è‡ªåŠ¨é—®ç­”API

#### DQAæœåŠ¡çŠ¶æ€
```http
GET /api/dqa/status
```

**å“åº”**:
```json
{
  "success": true,
  "service": "DQA Hospital Q&A Service",
  "version": "1.0.0",
  "status": "running",
  "scheduler": {
    "is_running": true,
    "total_generated": 960,
    "total_success": 954,
    "total_failed": 6,
    "success_rate": "99.38%",
    "last_run": "2025-10-26T10:45:00.000Z",
    "next_run": "2025-10-26T11:00:00.000Z"
  }
}
```

#### è·å–åŒ»é™¢æ¸…å•
```http
GET /api/dqa/hospitals
```

**åŠŸèƒ½**: è¿”å›122å®¶åŒ»é™¢æ¸…å•å’ŒåŸå¸‚åˆ†å¸ƒ

#### æ‰‹åŠ¨ç”ŸæˆDQAé—®ç­”
```http
POST /api/dqa/generate
Content-Type: application/json

{
  "count": 10
}
```

#### æ§åˆ¶å®šæ—¶ä»»åŠ¡
```http
POST /api/dqa/scheduler/:action
# action: start | stop | restart
```

#### åˆ†æè¿é”åŒ»é™¢
```http
GET /api/dqa/chain-hospitals/analyze
```

### Webhooké›†æˆAPI

#### N8Né€šç”¨Webhook
```http
POST /api/webhooks/n8n
Content-Type: application/json

{
  "type": "user_share|knowledge|hospital",
  "data": { ... },
  "source": "n8n"
}
```

#### æ‰¹é‡æ•°æ®å¤„ç†
```http
POST /api/webhooks/batch
Content-Type: application/json

{
  "items": [
    { "type": "user_share", "data": { ... } },
    { "type": "knowledge", "data": { ... } }
  ]
}
```

#### æ•°æ®åŒæ­¥çŠ¶æ€
```http
GET /api/webhooks/sync-status
```

---

## ğŸ Pythonæ™ºèƒ½ä½“ç³»ç»Ÿæ–‡æ¡£

### 1. ç¿»è¯‘æ™ºèƒ½ä½“ (qa_translator_agent.py)

**ä½ç½®**: `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/scripts/qa_translator_agent.py`  
**åŠŸèƒ½**: å°†ä¸­æ–‡é—®ç­”ç¿»è¯‘ä¸º100%çº¯è¶Šå—è¯­  
**æŠ€æœ¯**: Python + Doubao LLM API + Ark API

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… å‡åŒ€åˆ†å¸ƒç¿»è¯‘ (5å¤§åˆ†ç±»å¹³è¡¡)
- âœ… ä¸­æ–‡æ£€æµ‹ä¸è‡ªåŠ¨æ¸…ç†
- âœ… 5æ¬¡é‡è¯•æœºåˆ¶
- âœ… è¿›åº¦è¿½è¸ª (translation_progressè¡¨)
- âœ… åˆ†ç±»æ˜ å°„ (ä¸­æ–‡ â†” è¶Šå—è¯­)

**è¿è¡Œæ–¹å¼**:
```bash
# åå°è¿è¡Œï¼Œè¿ç»­ç”Ÿæˆ100æ¡
nohup python scripts/qa_translator_agent.py --batch 100 > logs/translator.log 2>&1 &

# æ‰‹åŠ¨ç”Ÿæˆ2æ¡
python scripts/qa_translator_agent.py --batch 2

# æŸ¥çœ‹è¿›åº¦
python scripts/qa_translator_agent.py --status
```

**å…³é”®é…ç½®**:
- LLMæ¨¡å‹: `Doubao-Seed-1.6-flash`
- API: `Volces Ark API`
- é‡è¯•æ¬¡æ•°: 5æ¬¡
- å•æ¬¡å»¶è¿Ÿ: 1ç§’
- æ‰¹æ¬¡å»¶è¿Ÿ: 2ç§’

**åˆ†ç±»æ˜ å°„**:
```python
{
    "ä¸°èƒ¸": "Tháº©m má»¹ ngá»±c",
    "äº”å®˜": "Tháº©m má»¹ khuÃ´n máº·t",
    "äº§ä¿®": "Phá»¥c há»“i sau sinh",
    "å¸è„‚": "HÃºt má»¡ táº¡o dÃ¡ng",
    "ç‰™çŸ«": "Niá»ng rÄƒng"
}
```

### 2. è´¨é‡æ£€æŸ¥æ™ºèƒ½ä½“ (qa_quality_checker.py)

**ä½ç½®**: `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/scripts/qa_quality_checker.py`  
**åŠŸèƒ½**: è‡ªåŠ¨æ£€æŸ¥å’Œä¿®æ­£çŸ¥è¯†é—®ç­”è´¨é‡  
**æŠ€æœ¯**: Python + Doubao LLM API

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… 5ç»´åº¦è´¨é‡æ£€æŸ¥
  * å‡†ç¡®æ€§ (Accuracy)
  * ä¸€è‡´æ€§ (Consistency)
  * å®Œæ•´æ€§ (Completeness)
  * æ¸…æ™°åº¦ (Clarity)
  * å®‰å…¨æ€§ (Safety)
- âœ… è‡ªåŠ¨ä¿®æ­£é—®é¢˜
- âœ… è´¨é‡è¯„åˆ† (0-100åˆ†)
- âœ… ä¿®æ”¹å†å²è¿½è¸ª
- âœ… æ‰¹é‡æ£€æŸ¥æ”¯æŒ

**è¿è¡Œæ–¹å¼**:
```bash
# æ£€æŸ¥100æ¡éšæœºé—®ç­”
python scripts/qa_quality_checker.py --batch 100

# æ£€æŸ¥ç‰¹å®šåˆ†ç±»
python scripts/qa_quality_checker.py --category "Tháº©m má»¹ ngá»±c" --batch 50

# æŸ¥çœ‹æ£€æŸ¥å†å²
python scripts/qa_quality_checker.py --report
```

**æ£€æŸ¥ç»´åº¦è¯´æ˜**:
```
å‡†ç¡®æ€§: åŒ»å­¦ä¿¡æ¯æ˜¯å¦å‡†ç¡®ã€æ— è¯¯å¯¼
ä¸€è‡´æ€§: ç­”æ¡ˆä¸å…¶ä»–ç›¸ä¼¼é—®é¢˜æ˜¯å¦ä¸€è‡´
å®Œæ•´æ€§: ç­”æ¡ˆæ˜¯å¦å®Œæ•´ã€å…¨é¢ã€æœ‰ç»“æ„
æ¸…æ™°åº¦: è¡¨è¾¾æ˜¯å¦æ¸…æ™°ã€æ˜“ç†è§£ã€æ— æ­§ä¹‰
å®‰å…¨æ€§: æ˜¯å¦åŒ…å«ä¸å®‰å…¨å†…å®¹æˆ–åŒ»å­¦ç¦å¿Œ
```

### 3. æ•°æ®æ¸…ç†è„šæœ¬ (clean_chinese_records.py)

**ä½ç½®**: `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/scripts/clean_chinese_records.py`  
**åŠŸèƒ½**: æ¸…ç†database.sqliteä¸­çš„ä¸­æ–‡æ®‹ç•™  
**æŠ€æœ¯**: Python + SQLite

**åŠŸèƒ½**:
- âœ… æ£€æµ‹ä¸­æ–‡å­—ç¬¦
- âœ… åˆ é™¤å«ä¸­æ–‡çš„è®°å½•
- âœ… æ›´æ–°é”™è¯¯çš„åˆ†ç±»æ ‡ç­¾
- âœ… å¤‡ä»½åŸå§‹æ•°æ®

**è¿è¡Œæ–¹å¼**:
```bash
# æ¸…ç†ä¸­æ–‡è®°å½•
python scripts/clean_chinese_records.py

# å¤‡ä»½åæ¸…ç†
python scripts/clean_chinese_records.py --backup
```

### 4. Excelå¯¼å…¥å·¥å…· (excel-to-sqlite.py)

**ä½ç½®**: `/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/scripts/excel-to-sqlite.py`  
**åŠŸèƒ½**: ä»Excelæ–‡ä»¶æ‰¹é‡å¯¼å…¥æ•°æ®åˆ°SQLite  
**æŠ€æœ¯**: Python + pandas + SQLite

**æ”¯æŒ**:
- âœ… æ‰¹é‡å¯¼å…¥åŒ»é™¢æ•°æ®
- âœ… è‡ªåŠ¨æ•°æ®æ¸…ç†
- âœ… NaNå€¼å¤„ç†
- âœ… åˆ—åæ¸…ç†
- âœ… é”™è¯¯æ£€æµ‹

**è¿è¡Œæ–¹å¼**:
```bash
# å¯¼å…¥åŒ»é™¢æ•°æ®
python scripts/excel-to-sqlite.py \
  --excel data/hospitals.xlsx \
  --db backend/data/database.sqlite \
  --table hospitals
```

---

## ğŸ“Š æ•°æ®åº“æ¨¡å‹

### æ•°æ®æ¨¡å‹

#### 1. ç”¨æˆ·åˆ†äº«è¡¨ (user_shares)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| title | VARCHAR(200) | åˆ†äº«æ ‡é¢˜ |
| content | TEXT | åˆ†äº«å†…å®¹ |
| author_name | VARCHAR(100) | ä½œè€…å§“å |
| author_avatar | VARCHAR(500) | ä½œè€…å¤´åƒURL |
| surgery_type | VARCHAR(100) | æ‰‹æœ¯ç±»å‹ |
| hospital_name | VARCHAR(200) | åŒ»é™¢åç§° |
| rating | INTEGER | è¯„åˆ†(1-5æ˜Ÿ) |
| images | JSON | å›¾ç‰‡URLæ•°ç»„ |
| tags | JSON | æ ‡ç­¾æ•°ç»„ |
| status | ENUM | çŠ¶æ€(draft/published/archived) |
| view_count | INTEGER | æµè§ˆæ¬¡æ•° |
| like_count | INTEGER | ç‚¹èµæ¬¡æ•° |
| source | ENUM | æ•°æ®æ¥æº(n8n/manual/api) |
| external_id | VARCHAR(100) | å¤–éƒ¨ç³»ç»ŸID |

#### 2. çŸ¥è¯†é—®ç­”è¡¨ (knowledge)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| question | VARCHAR(500) | é—®é¢˜ |
| answer | TEXT | ç­”æ¡ˆ |
| category | VARCHAR(100) | åˆ†ç±» |
| subcategory | VARCHAR(100) | å­åˆ†ç±» |
| doctor_name | VARCHAR(100) | åŒ»ç”Ÿå§“å |
| doctor_title | VARCHAR(100) | åŒ»ç”ŸèŒç§° |
| doctor_avatar | VARCHAR(500) | åŒ»ç”Ÿå¤´åƒURL |
| hospital_name | VARCHAR(200) | åŒ»é™¢åç§° |
| like_count | INTEGER | ç‚¹èµæ¬¡æ•° |
| view_count | INTEGER | æµè§ˆæ¬¡æ•° |
| tags | JSON | æ ‡ç­¾æ•°ç»„ |
| difficulty_level | ENUM | éš¾åº¦çº§åˆ« |
| status | ENUM | çŠ¶æ€ |
| source | ENUM | æ•°æ®æ¥æº |
| external_id | VARCHAR(100) | å¤–éƒ¨ç³»ç»ŸID |

#### 3. åŒ»é™¢ä¿¡æ¯è¡¨ (hospitals)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| name | VARCHAR(200) | åŒ»é™¢åç§° |
| description | TEXT | åŒ»é™¢æè¿° |
| address | VARCHAR(500) | åŒ»é™¢åœ°å€ |
| city | VARCHAR(100) | æ‰€åœ¨åŸå¸‚ |
| district | VARCHAR(100) | æ‰€åœ¨åŒºå¿ |
| phone | VARCHAR(50) | è”ç³»ç”µè¯ |
| email | VARCHAR(100) | é‚®ç®± |
| website | VARCHAR(500) | å®˜ç½‘ |
| logo_url | VARCHAR(500) | Logo URL |
| images | JSON | åŒ»é™¢å›¾ç‰‡URLæ•°ç»„ |
| rating | DECIMAL(3,2) | ç»¼åˆè¯„åˆ† |
| review_count | INTEGER | è¯„ä»·æ•°é‡ |
| specialties | JSON | ä¸“ç§‘é¢†åŸŸæ•°ç»„ |
| services | JSON | æœåŠ¡é¡¹ç›®æ•°ç»„ |
| facilities | JSON | è®¾æ–½è®¾å¤‡æ•°ç»„ |
| certifications | JSON | è®¤è¯èµ„è´¨æ•°ç»„ |
| level | ENUM | åŒ»é™¢ç­‰çº§(A/B/C/D) |
| type | ENUM | åŒ»é™¢ç±»å‹ |
| status | ENUM | çŠ¶æ€ |
| source | ENUM | æ•°æ®æ¥æº |
| external_id | VARCHAR(100) | å¤–éƒ¨ç³»ç»ŸID |

#### 4. æœåŠ¡å†…å®¹è¡¨ (services)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| name | VARCHAR(200) | æœåŠ¡åç§° |
| description | TEXT | æœåŠ¡æè¿° |
| category | VARCHAR(100) | æœåŠ¡åˆ†ç±» |
| subcategory | VARCHAR(100) | æœåŠ¡å­åˆ†ç±» |
| price_min | DECIMAL(10,2) | æœ€ä½ä»·æ ¼ |
| price_max | DECIMAL(10,2) | æœ€é«˜ä»·æ ¼ |
| currency | VARCHAR(10) | è´§å¸å•ä½ |
| duration | VARCHAR(100) | æ‰‹æœ¯æ—¶é•¿ |
| recovery_time | VARCHAR(100) | æ¢å¤æ—¶é—´ |
| difficulty_level | ENUM | éš¾åº¦çº§åˆ« |
| icon | VARCHAR(500) | å›¾æ ‡URL |
| images | JSON | æœåŠ¡å›¾ç‰‡URLæ•°ç»„ |
| features | JSON | æœåŠ¡ç‰¹è‰²æ•°ç»„ |
| requirements | JSON | æœåŠ¡è¦æ±‚æ•°ç»„ |
| risks | JSON | é£é™©æç¤ºæ•°ç»„ |
| rating | DECIMAL(3,2) | æœåŠ¡è¯„åˆ† |
| review_count | INTEGER | è¯„ä»·æ•°é‡ |
| tags | JSON | æ ‡ç­¾æ•°ç»„ |
| is_popular | BOOLEAN | æ˜¯å¦çƒ­é—¨ |
| is_recommended | BOOLEAN | æ˜¯å¦æ¨è |
| status | ENUM | çŠ¶æ€ |
| source | ENUM | æ•°æ®æ¥æº |
| external_id | VARCHAR(100) | å¤–éƒ¨ç³»ç»ŸID |

#### 5. è”ç³»æˆ‘ä»¬è¡¨ (contacts)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| name | VARCHAR(100) | è”ç³»äººå§“å |
| email | VARCHAR(100) | é‚®ç®± |
| phone | VARCHAR(50) | ç”µè¯ |
| subject | VARCHAR(200) | ä¸»é¢˜ |
| message | TEXT | æ¶ˆæ¯å†…å®¹ |
| inquiry_type | ENUM | å’¨è¯¢ç±»å‹ |
| preferred_contact | ENUM | é¦–é€‰è”ç³»æ–¹å¼ |
| hospital_interest | VARCHAR(200) | æ„Ÿå…´è¶£çš„åŒ»é™¢ |
| service_interest | VARCHAR(200) | æ„Ÿå…´è¶£çš„æœåŠ¡ |
| budget_range | VARCHAR(100) | é¢„ç®—èŒƒå›´ |
| timeline | VARCHAR(100) | æ—¶é—´å®‰æ’ |
| status | ENUM | å¤„ç†çŠ¶æ€ |
| priority | ENUM | ä¼˜å…ˆçº§ |
| assigned_to | VARCHAR(100) | åˆ†é…ç»™ |
| response | TEXT | å›å¤å†…å®¹ |
| response_date | DATE | å›å¤æ—¶é—´ |
| source | ENUM | æ•°æ®æ¥æº |
| external_id | VARCHAR(100) | å¤–éƒ¨ç³»ç»ŸID |

## ğŸ”Œ APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://47.237.79.9:5002/api`
- **Content-Type**: `application/json`
- **å“åº”æ ¼å¼**: JSON

### é€šç”¨å“åº”æ ¼å¼

```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {},
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "pages": 10
  }
}
```

### ç”¨æˆ·åˆ†äº«API

#### è·å–ç”¨æˆ·åˆ†äº«åˆ—è¡¨
```http
GET /api/user-shares
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤: 1)
- `limit`: æ¯é¡µæ•°é‡ (é»˜è®¤: 10)
- `status`: çŠ¶æ€ (é»˜è®¤: published)
- `surgery_type`: æ‰‹æœ¯ç±»å‹
- `hospital_name`: åŒ»é™¢åç§°
- `search`: æœç´¢å…³é”®è¯

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "Pháº«u thuáº­t mÅ©i táº¡i TP.HCM",
      "content": "Tráº£i nghiá»‡m tuyá»‡t vá»i...",
      "author_name": "Chá»‹ LÃ½",
      "surgery_type": "Pháº«u thuáº­t mÅ©i",
      "hospital_name": "Bá»‡nh viá»‡n tháº©m má»¹ TP.HCM",
      "rating": 5,
      "like_count": 128,
      "view_count": 456,
      "created_at": "2024-03-12T00:00:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 50,
    "pages": 5
  }
}
```

#### è·å–å•ä¸ªç”¨æˆ·åˆ†äº«
```http
GET /api/user-shares/:id
```

#### ç‚¹èµç”¨æˆ·åˆ†äº«
```http
POST /api/user-shares/:id/like
```

### çŸ¥è¯†é—®ç­”API

#### è·å–çŸ¥è¯†é—®ç­”åˆ—è¡¨
```http
GET /api/knowledge
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `status`: çŠ¶æ€
- `category`: åˆ†ç±»
- `subcategory`: å­åˆ†ç±»
- `difficulty_level`: éš¾åº¦çº§åˆ«
- `search`: æœç´¢å…³é”®è¯

### åŒ»é™¢API

#### è·å–åŒ»é™¢åˆ—è¡¨
```http
GET /api/hospitals
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `status`: çŠ¶æ€
- `city`: åŸå¸‚
- `type`: åŒ»é™¢ç±»å‹
- `level`: åŒ»é™¢ç­‰çº§
- `search`: æœç´¢å…³é”®è¯

### æœåŠ¡API

#### è·å–æœåŠ¡åˆ—è¡¨
```http
GET /api/services
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡
- `status`: çŠ¶æ€
- `category`: åˆ†ç±»
- `subcategory`: å­åˆ†ç±»
- `difficulty_level`: éš¾åº¦çº§åˆ«
- `is_popular`: æ˜¯å¦çƒ­é—¨
- `is_recommended`: æ˜¯å¦æ¨è
- `search`: æœç´¢å…³é”®è¯

### è”ç³»API

#### åˆ›å»ºè”ç³»è®°å½•
```http
POST /api/contacts
```

**è¯·æ±‚ä½“**:
```json
{
  "name": "Nguyá»…n VÄƒn A",
  "email": "nguyenvana@email.com",
  "phone": "+84-123-456-789",
  "subject": "TÆ° váº¥n pháº«u thuáº­t mÅ©i",
  "message": "TÃ´i muá»‘n tÆ° váº¥n vá» pháº«u thuáº­t mÅ©i...",
  "inquiry_type": "consultation",
  "preferred_contact": "email",
  "hospital_interest": "Bá»‡nh viá»‡n tháº©m má»¹ TP.HCM",
  "service_interest": "Pháº«u thuáº­t mÅ©i",
  "budget_range": "2000-4000 USD",
  "timeline": "ThÃ¡ng 6/2024"
}
```

### DQAåŒ»é™¢è‡ªåŠ¨é—®ç­”API (æ–°å¢åŠŸèƒ½)

#### DQAæœåŠ¡çŠ¶æ€
```http
GET /api/dqa/status
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "service": "DQA Hospital Q&A Service",
  "version": "1.0.0",
  "status": "running",
  "scheduler": {
    "is_running": true,
    "total_generated": 960,
    "total_success": 954,
    "total_failed": 6,
    "success_rate": "99.38%",
    "last_run": "2025-10-26T10:45:00.000Z",
    "next_run": "2025-10-26T11:00:00.000Z"
  }
}
```

#### è·å–åŒ»é™¢æ¸…å•
```http
GET /api/dqa/hospitals
```

**å“åº”**: è¿”å›122å®¶åŒ»é™¢çš„æ¸…å•å’ŒåŸå¸‚åˆ†å¸ƒç»Ÿè®¡

#### æ‰‹åŠ¨ç”ŸæˆDQAé—®ç­”
```http
POST /api/dqa/generate
Content-Type: application/json

{
  "count": 10  // ç”Ÿæˆæ•°é‡ï¼Œ1-100ä¹‹é—´
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æˆåŠŸç”Ÿæˆ10æ¡DQA",
  "data": {
    "total": 10,
    "success": 10,
    "failed": 0,
    "created": [
      {
        "id": 299,
        "question": "Sá»‘ Ä‘iá»‡n thoáº¡i cá»§a Bá»‡nh viá»‡n Da liá»…u HÃ  Ná»™i lÃ  gÃ¬?",
        "hospital": "Bá»‡nh viá»‡n Da liá»…u HÃ  Ná»™i"
      }
    ]
  }
}
```

#### æ§åˆ¶å®šæ—¶ä»»åŠ¡
```http
POST /api/dqa/scheduler/:action
# action: start | stop | restart
```

#### åˆ†æè¿é”åŒ»é™¢
```http
GET /api/dqa/chain-hospitals/analyze
```

#### DQAåŠŸèƒ½è¯´æ˜

**DQAï¼ˆDynamic Question & Answerï¼‰åŒ»é™¢è‡ªåŠ¨é—®ç­”ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªæ™ºèƒ½åŒ–çš„å†…å®¹ç”Ÿæˆç³»ç»Ÿï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1. **è‡ªåŠ¨é—®ç­”ç”Ÿæˆ** - åŸºäº122å®¶åŒ»é™¢æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆ6ç§ç±»å‹çš„é—®ç­”ï¼š
   - åŒ»é™¢èµ„è´¨ (certification)
   - åŒ»é™¢ç­‰çº§ (level)
   - æœåŠ¡å†…å®¹ (services)
   - åœ°å€ä¿¡æ¯ (location)
   - è”ç³»æ–¹å¼ (contact)
   - åŒ»ç”Ÿå›¢é˜Ÿ (doctors)

2. **å®šæ—¶ä»»åŠ¡** - æ¯15åˆ†é’Ÿè‡ªåŠ¨ç”Ÿæˆ1æ¡é—®ç­”å¹¶å‘å¸ƒåˆ°çŸ¥è¯†é—®ç­”æ¿å—

3. **è¿é”åŒ»é™¢ç®¡ç†** - è‡ªåŠ¨è¯†åˆ«è¿é”åŒ»é™¢ï¼Œå¹¶ä¸ºç¼ºå¤±åŸå¸‚ç”Ÿæˆåˆ†åº—å»ºè®®

4. **æ•°æ®æå–** - ä»æ•°æ®åº“æå–åŒ»é™¢ä¿¡æ¯ï¼Œç”Ÿæˆæ‘˜è¦å’Œç»Ÿè®¡

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š`/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/src/dqa/README.md`

### Webhook API

#### N8N Webhook
```http
POST /api/webhooks/n8n
```

**è¯·æ±‚ä½“**:
```json
{
  "type": "user_share",
  "data": {
    "title": "åˆ†äº«æ ‡é¢˜",
    "content": "åˆ†äº«å†…å®¹",
    "author_name": "ä½œè€…å§“å",
    "surgery_type": "æ‰‹æœ¯ç±»å‹",
    "hospital_name": "åŒ»é™¢åç§°",
    "rating": 5,
    "external_id": "external_123"
  },
  "source": "n8n"
}
```

#### æ‰¹é‡æ•°æ®å¤„ç†
```http
POST /api/webhooks/batch
```

**è¯·æ±‚ä½“**:
```json
{
  "items": [
    {
      "type": "user_share",
      "data": { ... }
    },
    {
      "type": "knowledge",
      "data": { ... }
    }
  ]
}
```

#### åŒæ­¥çŠ¶æ€æ£€æŸ¥
```http
GET /api/webhooks/sync-status
```

## ğŸ“¦ ä¾èµ–ç®¡ç†

### ç”Ÿäº§ä¾èµ– (dependencies)

| åŒ…å | ç‰ˆæœ¬ | å®é™…ç‰ˆæœ¬ | æè¿° | ç”¨é€” |
|------|------|----------|------|------|
| axios | ^1.6.2 | 1.12.2 | HTTPå®¢æˆ·ç«¯åº“ | å¤–éƒ¨APIè°ƒç”¨ã€æ•°æ®è·å– |
| compression | ^1.8.1 | 1.8.1 | HTTPå‹ç¼©ä¸­é—´ä»¶ | å¯ç”¨Gzipå‹ç¼©ï¼Œå‡å°‘ä¼ è¾“å¤§å° |
| cors | ^2.8.5 | 2.8.5 | è·¨åŸŸèµ„æºå…±äº« | å¤„ç†å‰ç«¯è·¨åŸŸè¯·æ±‚ |
| dotenv | ^16.3.1 | 16.6.1 | ç¯å¢ƒå˜é‡ç®¡ç† | åŠ è½½.envé…ç½®æ–‡ä»¶ |
| express | ^4.18.2 | 4.21.2 | Webåº”ç”¨æ¡†æ¶ | æ ¸å¿ƒHTTPæœåŠ¡å™¨æ¡†æ¶ |
| express-rate-limit | ^7.5.1 | 7.5.1 | APIé™æµä¸­é—´ä»¶ | é˜²æ­¢APIæ»¥ç”¨å’ŒDDoSæ”»å‡» |
| helmet | ^7.1.0 | 7.2.0 | å®‰å…¨ä¸­é—´ä»¶ | è®¾ç½®å®‰å…¨HTTPå¤´éƒ¨ |
| joi | ^17.11.0 | 17.13.3 | æ•°æ®éªŒè¯åº“ | APIè¾“å…¥æ•°æ®éªŒè¯ |
| morgan | ^1.10.0 | 1.10.1 | HTTPè¯·æ±‚æ—¥å¿— | è®°å½•HTTPè¯·æ±‚ä¿¡æ¯ |
| multer | ^1.4.5-lts.1 | 1.4.5-lts.2 | æ–‡ä»¶ä¸Šä¼ å¤„ç† | å¤„ç†multipart/form-data |
| node-cron | ^3.0.3 | 3.0.3 | å®šæ—¶ä»»åŠ¡è°ƒåº¦ | æ‰§è¡Œå®šæ—¶ä»»åŠ¡å’Œæ•°æ®åŒæ­¥ |
| sequelize | ^6.35.0 | 6.37.7 | ORMæ¡†æ¶ | æ•°æ®åº“æ“ä½œå’Œæ¨¡å‹ç®¡ç† |
| sqlite3 | ^5.1.6 | 5.1.7 | SQLiteæ•°æ®åº“é©±åŠ¨ | æ•°æ®åº“è¿æ¥å’Œæ“ä½œ |
| winston | ^3.11.0 | 3.18.3 | æ—¥å¿—ç®¡ç†åº“ | ç»“æ„åŒ–æ—¥å¿—è®°å½•å’Œç®¡ç† |

### å¼€å‘ä¾èµ– (devDependencies)

| åŒ…å | ç‰ˆæœ¬ | æè¿° | ç”¨é€” |
|------|------|------|------|
| jest | ^29.7.0 | æµ‹è¯•æ¡†æ¶ | å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯• |
| nodemon | ^3.1.10 | å¼€å‘å·¥å…· | æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯æœåŠ¡ |
| supertest | ^6.3.4 | HTTPæµ‹è¯•åº“ | APIç«¯ç‚¹æµ‹è¯• |

### ä¾èµ–å®‰è£…å’Œç®¡ç†

#### å®‰è£…æ‰€æœ‰ä¾èµ–
```bash
npm install
```

#### å®‰è£…ç”Ÿäº§ä¾èµ–
```bash
npm install --production
```

#### æ›´æ–°ä¾èµ–
```bash
# æ£€æŸ¥è¿‡æ—¶çš„åŒ…
npm outdated

# æ›´æ–°æ‰€æœ‰åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬
npm update

# æ›´æ–°ç‰¹å®šåŒ…
npm install package-name@latest
```

#### å®‰å…¨å®¡è®¡
```bash
# æ£€æŸ¥å®‰å…¨æ¼æ´
npm audit

# è‡ªåŠ¨ä¿®å¤å®‰å…¨é—®é¢˜
npm audit fix
```

### ç‰ˆæœ¬å…¼å®¹æ€§

- **Node.js**: è¦æ±‚ v18.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: è¦æ±‚ v8.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: æ”¯æŒ Linuxã€macOSã€Windows

### ä¾èµ–è¯´æ˜

#### æ ¸å¿ƒæ¡†æ¶
- **Express**: è½»é‡çº§Webæ¡†æ¶ï¼Œæä¾›è·¯ç”±ã€ä¸­é—´ä»¶ç­‰åŠŸèƒ½
- **Sequelize**: åŠŸèƒ½å¼ºå¤§çš„ORMï¼Œæ”¯æŒå¤šç§æ•°æ®åº“

#### å®‰å…¨ç›¸å…³
- **Helmet**: è®¾ç½®å„ç§HTTPå¤´éƒ¨æ¥ä¿æŠ¤åº”ç”¨å®‰å…¨
- **CORS**: é…ç½®è·¨åŸŸèµ„æºå…±äº«ç­–ç•¥
- **Express Rate Limit**: å®ç°APIé™æµï¼Œé˜²æ­¢æ»¥ç”¨

#### æ•°æ®å¤„ç†
- **Joi**: å¼ºå¤§çš„æ•°æ®éªŒè¯åº“ï¼Œæ”¯æŒå¤æ‚éªŒè¯è§„åˆ™
- **Multer**: å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ä¸­é—´ä»¶

#### å·¥å…·åº“
- **Winston**: çµæ´»çš„æ—¥å¿—åº“ï¼Œæ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼
- **Axios**: åŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯
- **Node-cron**: ç±»ä¼¼Linux cronçš„ä»»åŠ¡è°ƒåº¦å™¨

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒè¦æ±‚

- Node.js v18+
- npm v8+
- SQLite3
- systemd (Linux)

### 2. å®‰è£…ä¾èµ–

```bash
cd /root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend
npm install
```

### 3. é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp config.env .env

# ç¼–è¾‘é…ç½®
nano .env
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run init-db
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
npm start
```

### 6. ä½¿ç”¨éƒ¨ç½²è„šæœ¬

```bash
# ä¸€é”®éƒ¨ç½²
./deploy.sh
```

### 7. æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
systemctl start vietnam-medical-backend.service

# åœæ­¢æœåŠ¡
systemctl stop vietnam-medical-backend.service

# é‡å¯æœåŠ¡
systemctl restart vietnam-medical-backend.service

# æŸ¥çœ‹çŠ¶æ€
systemctl status vietnam-medical-backend.service

# æŸ¥çœ‹æ—¥å¿—
journalctl -u vietnam-medical-backend.service -f
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>

# è¿›å…¥åç«¯ç›®å½•
cd backend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ä»£ç è§„èŒƒ

1. **æ–‡ä»¶å‘½å**: ä½¿ç”¨ camelCase (å¦‚: `userShareRoutes.js`)
2. **å‡½æ•°å‘½å**: ä½¿ç”¨ camelCase
3. **å¸¸é‡å‘½å**: ä½¿ç”¨ UPPER_SNAKE_CASE
4. **æ³¨é‡Š**: ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š
5. **ç¼©è¿›**: ä½¿ç”¨ 2 ä¸ªç©ºæ ¼

### æ•°æ®åº“æ“ä½œ

```javascript
// åˆ›å»ºè®°å½•
const userShare = await UserShare.create({
  title: 'æ ‡é¢˜',
  content: 'å†…å®¹',
  author_name: 'ä½œè€…'
});

// æŸ¥è¯¢è®°å½•
const userShares = await UserShare.findAll({
  where: { status: 'published' },
  limit: 10,
  offset: 0
});

// æ›´æ–°è®°å½•
await userShare.update({ title: 'æ–°æ ‡é¢˜' });

// åˆ é™¤è®°å½•
await userShare.destroy();
```

### æ—¥å¿—è®°å½•

```javascript
import { logger } from '../utils/logger.js';

// ä¿¡æ¯æ—¥å¿—
logger.info('æ“ä½œæˆåŠŸ', { userId: 123 });

// é”™è¯¯æ—¥å¿—
logger.error('æ“ä½œå¤±è´¥', { error: error.message });

// è­¦å‘Šæ—¥å¿—
logger.warn('éœ€è¦æ³¨æ„', { data: 'some data' });
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ SQLite æ–‡ä»¶è·¯å¾„
   - ç¡®ä¿ data ç›®å½•å­˜åœ¨
   - æ£€æŸ¥æ–‡ä»¶æƒé™

2. **ç«¯å£è¢«å ç”¨**
   - æ£€æŸ¥ç«¯å£ 5002 æ˜¯å¦è¢«å ç”¨
   - ä¿®æ”¹ config.env ä¸­çš„ PORT é…ç½®

3. **ä¾èµ–å®‰è£…å¤±è´¥**
   - æ£€æŸ¥ Node.js ç‰ˆæœ¬
   - æ¸…ç† npm ç¼“å­˜: `npm cache clean --force`
   - åˆ é™¤ node_modules é‡æ–°å®‰è£…

4. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥æ—¥å¿—: `journalctl -u vietnam-medical-backend.service -f`
   - æ£€æŸ¥é…ç½®æ–‡ä»¶
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```bash
   export LOG_LEVEL=debug
   npm start
   ```

2. **æ•°æ®åº“è°ƒè¯•**
   ```bash
   sqlite3 data/medical.db
   .tables
   .schema user_shares
   ```

3. **APIæµ‹è¯•**
   ```bash
   curl -X GET http://localhost:5002/health
   curl -X GET http://localhost:5002/api/info
   ```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
2. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨é€‚å½“çš„ WHERE æ¡ä»¶
3. **åˆ†é¡µæŸ¥è¯¢**: ä½¿ç”¨ LIMIT å’Œ OFFSET
4. **è¿æ¥æ± **: é…ç½® Sequelize è¿æ¥æ± 

### APIä¼˜åŒ–

1. **å“åº”å‹ç¼©**: ä½¿ç”¨ gzip å‹ç¼©
2. **ç¼“å­˜ç­–ç•¥**: å®ç°é€‚å½“çš„ç¼“å­˜æœºåˆ¶
3. **é™æµ**: å®ç° API é™æµ
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ”’ å®‰å…¨é…ç½®

### å®‰å…¨ä¸­é—´ä»¶é…ç½®

#### Helmet å®‰å…¨å¤´éƒ¨
```javascript
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      scriptSrc: ["'self'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
}));
```

#### CORS è·¨åŸŸé…ç½®
```javascript
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:4321',
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));
```

#### API é™æµé…ç½®
```javascript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100, // é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š100ä¸ªè¯·æ±‚
  message: {
    success: false,
    message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
  }
});
app.use('/api/', limiter);
```

### æ•°æ®éªŒè¯

- ä½¿ç”¨ Joi v17.13.3 è¿›è¡Œè¾“å…¥éªŒè¯
- é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»
- é˜²æ­¢ XSS æ”»å‡»
- è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼š10MB

### è®¿é—®æ§åˆ¶

- CORS é…ç½®é™åˆ¶å‰ç«¯è®¿é—®æº
- API è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆ15åˆ†é’Ÿ100æ¬¡ï¼‰
- è¾“å…¥é•¿åº¦å’Œç±»å‹éªŒè¯
- å®‰å…¨å¤´éƒ¨è®¾ç½®

### æ—¥å¿—å®‰å…¨

- ä½¿ç”¨ Winston è¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•
- ä¸è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€ä»¤ç‰Œç­‰ï¼‰
- æ—¥å¿—æ–‡ä»¶æƒé™æ§åˆ¶
- å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶
- è¯·æ±‚æ—¥å¿—åŒ…å«IPå’ŒUser-Agentä¿¡æ¯

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:5002/health

# æ£€æŸ¥APIä¿¡æ¯
curl http://localhost:5002/api/info

# æ£€æŸ¥åŒæ­¥çŠ¶æ€
curl http://localhost:5002/api/webhooks/sync-status
```

### æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
journalctl -u vietnam-medical-backend.service -f

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -u vietnam-medical-backend.service --since "1 hour ago" | grep ERROR
```

### æ•°æ®åº“ç»´æŠ¤

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/medical.db data/medical_backup_$(date +%Y%m%d).db

# æ£€æŸ¥æ•°æ®åº“å¤§å°
ls -lh data/medical.db

# ä¼˜åŒ–æ•°æ®åº“
sqlite3 data/medical.db "VACUUM;"
```

## ğŸ¤– DQAåŒ»é™¢è‡ªåŠ¨é—®ç­”ç³»ç»Ÿ

### ç³»ç»Ÿæ¦‚è¿°
DQAï¼ˆDynamic Question & Answerï¼‰æ˜¯ä¸€ä¸ªæ™ºèƒ½åŒ–çš„åŒ»é™¢é—®ç­”ç”Ÿæˆç³»ç»Ÿï¼ŒåŸºäº122å®¶åŒ»é™¢çš„çœŸå®æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆå¹¶å‘å¸ƒåŒ»é™¢ç›¸å…³é—®ç­”å†…å®¹ã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **åŒ»é™¢æ•°æ®æå–**: ä»æ•°æ®åº“æå–122å®¶åŒ»é™¢ä¿¡æ¯ï¼Œç”Ÿæˆæ¸…å•å’Œç»Ÿè®¡
2. **è¿é”åŒ»é™¢ç®¡ç†**: è¯†åˆ«è¿é”åŒ»é™¢å“ç‰Œï¼Œä¸ºç¼ºå¤±åŸå¸‚ç”Ÿæˆåˆ†åº—å»ºè®®
3. **é—®ç­”è‡ªåŠ¨ç”Ÿæˆ**: æ ¹æ®åŒ»é™¢ä¿¡æ¯ç”Ÿæˆ6ç§ç±»å‹çš„ä¸“ä¸šé—®ç­”
4. **å®šæ—¶ä»»åŠ¡**: æ¯15åˆ†é’Ÿè‡ªåŠ¨ç”Ÿæˆ1æ¡é—®ç­”å¹¶å‘å¸ƒ

### é—®ç­”ç±»å‹
- **åŒ»é™¢èµ„è´¨** (certification): è®¤è¯ã€ç­‰çº§ã€è®¸å¯è¯
- **åŒ»é™¢è¯„çº§** (level): ç­‰çº§ã€è¯„åˆ†ã€å£ç¢‘
- **æœåŠ¡å†…å®¹** (services): æœåŠ¡é¡¹ç›®ã€ä¸“ç§‘é¢†åŸŸ
- **åœ°å€ä¿¡æ¯** (location): åœ°å€ã€äº¤é€šã€å¯¼èˆª
- **è”ç³»æ–¹å¼** (contact): ç”µè¯ã€é‚®ç®±ã€é¢„çº¦
- **åŒ»ç”Ÿå›¢é˜Ÿ** (doctors): åŒ»ç”Ÿèµ„è´¨ã€ä¸“ä¸šæ°´å¹³

### æ–‡ä»¶ç»“æ„
```
backend/src/dqa/
â”œâ”€â”€ dqaRoutes.js              # APIè·¯ç”±
â”œâ”€â”€ dqaService.js             # æœåŠ¡ä¸»æ§åˆ¶å™¨
â”œâ”€â”€ dqaScheduler.js           # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ dqaGenerator.js           # é—®ç­”å†…å®¹ç”Ÿæˆå™¨
â”œâ”€â”€ hospitalDataExtractor.js  # åŒ»é™¢æ•°æ®æå–å™¨
â”œâ”€â”€ chainHospitalEnhancer.js  # è¿é”åŒ»é™¢è¡¥å……å™¨
â”œâ”€â”€ README.md                 # æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ DQAä½¿ç”¨æŒ‡å—.md            # ä½¿ç”¨æŒ‡å—
â””â”€â”€ éƒ¨ç½²å®ŒæˆæŠ¥å‘Š.md           # éƒ¨ç½²æŠ¥å‘Š
```

### å¿«é€Ÿå‘½ä»¤
```bash
# æŸ¥çœ‹DQAçŠ¶æ€
curl http://localhost:5002/api/dqa/status

# æ‰‹åŠ¨ç”Ÿæˆ10æ¡é—®ç­”
curl -X POST http://localhost:5002/api/dqa/generate \
  -H "Content-Type: application/json" \
  -d '{"count": 10}'

# æ§åˆ¶å®šæ—¶ä»»åŠ¡
curl -X POST http://localhost:5002/api/dqa/scheduler/start
curl -X POST http://localhost:5002/api/dqa/scheduler/stop
curl -X POST http://localhost:5002/api/dqa/scheduler/restart

# æŸ¥çœ‹åŒ»é™¢æ¸…å•
curl http://localhost:5002/api/dqa/hospitals
```

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š
- æŠ€æœ¯æ–‡æ¡£ï¼š`/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/backend/src/dqa/README.md`
- ä½¿ç”¨æŒ‡å—ï¼š`/root/è¶Šå—åŒ»ç–—æ•´å½¢é¡¹ç›®/docs/DQAä½¿ç”¨æŒ‡å—.md`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **é¡¹ç›®ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ
- **æ–‡æ¡£æ›´æ–°**: 2025-10-11
- **ç‰ˆæœ¬**: v1.4.0

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šéšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œè¯·å®šæœŸæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚
